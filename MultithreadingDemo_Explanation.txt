# –ü–æ–ª–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã Multithreading Demo (8 –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ –û–û–ü)

## 1. –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

Multithreading Demo - —ç—Ç–æ –∫–æ–Ω—Å–æ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ C#, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–µ–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è. –ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π, –∏–ª–ª—é—Å—Ç—Ä–∏—Ä—É—é—â–∏—Ö –ø—Ä–æ–±–ª–µ–º—ã –≥–æ–Ω–∫–∏ –¥–∞–Ω–Ω—ã—Ö (race conditions) –∏ –ø–∞—Ç—Ç–µ—Ä–Ω Producer-Consumer —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:
```
8–ª–∞–±–∞–û–û–ü/
‚îú‚îÄ‚îÄ Expl.md                        - –°—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ Lab8.md                        - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ MultithreadingDemo/            - –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–µ–∫—Ç
‚îÇ   ‚îú‚îÄ‚îÄ Program.cs                 - –ì–ª–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ RaceCondition.cs           - –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≥–æ–Ω–∫–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ ProducerConsumer.cs        - –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è Producer-Consumer
‚îÇ   ‚îú‚îÄ‚îÄ README.md                  - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ [–î—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã]             - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
```

## 2. –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–æ–≥—Ä–∞–º–º—ã (Program.cs)

```csharp
using System;

class Program
{
    static void Main()
    {
        while (true)
        {
            Console.WriteLine("\n–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ:");
            Console.WriteLine("1 ‚Äî –ì–æ–Ω–∫–∞ –¥–∞–Ω–Ω—ã—Ö");
            Console.WriteLine("2 ‚Äî Producer‚ÄìConsumer");
            Console.WriteLine("0 ‚Äî –í—ã—Ö–æ–¥");
            Console.Write("–í–∞—à –≤—ã–±–æ—Ä: ");

            string choice = Console.ReadLine() ?? "0";

            switch (choice)
            {
                case "1":
                    RaceConditionDemo.Run();
                    break;
                case "2":
                    ProducerConsumerDemo.Run();
                    break;
                case "0":
                    return;
                default:
                    Console.WriteLine("–ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.");
                    break;
            }
        }
    }
}
```

**–ü–æ—è—Å–Ω–µ–Ω–∏–µ:**
- –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
- –†–µ–∞–ª–∏–∑—É–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
- –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Å—Ç–æ–π –ø–æ–¥—Ö–æ–¥ —Å –∫–æ–Ω—Å–æ–ª—å–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º

## 3. –ó–∞–¥–∞–Ω–∏–µ 1: –ì–æ–Ω–∫–∞ –¥–∞–Ω–Ω—ã—Ö (RaceCondition.cs)

```csharp
using System;
using System.Diagnostics;
using System.Threading;

public static class RaceConditionDemo
{
    private static int counter = 0;
    private static object lockObj = new object();

    public static void Run()
    {
        Console.WriteLine("\n--- –ó–∞–¥–∞–Ω–∏–µ 1: –ì–æ–Ω–∫–∞ –¥–∞–Ω–Ω—ã—Ö ---");
        Console.Write("–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤: ");
        int threadsCount = int.Parse(Console.ReadLine() ?? "4");

        Console.Write("–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ç–æ–∫–∞: ");
        int increments = int.Parse(Console.ReadLine() ?? "100000");

        Console.Write("–í—ã–≤–æ–¥–∏—Ç—å —à–∞–≥–∏? (y/n): ");
        bool showSteps = Console.ReadLine()?.ToLower() == "y";

        Console.WriteLine("\nUnsafeIncrement:");
        RunIncrementTest(UnsafeIncrement, threadsCount, increments, showSteps);

        Console.WriteLine("\nLockIncrement:");
        RunIncrementTest(LockIncrement, threadsCount, increments, showSteps);

        Console.WriteLine("\nInterlockedIncrement:");
        RunIncrementTest(InterlockedIncrement, threadsCount, increments, showSteps);
    }

    private static void RunIncrementTest(Action<int> incrementMethod, int threadsCount, int increments, bool showSteps)
    {
        counter = 0;
        Stopwatch sw = Stopwatch.StartNew();

        Thread[] threads = new Thread[threadsCount];
        for (int i = 0; i < threadsCount; i++)
        {
            threads[i] = new Thread(() => incrementMethod(increments));
            threads[i].Start();
        }

        foreach (var t in threads)
            t.Join();

        sw.Stop();
        Console.WriteLine($"–í—Ä–µ–º—è: {sw.ElapsedMilliseconds} ms, –ò—Ç–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ counter = {counter}");
    }

    private static void UnsafeIncrement(int n)
    {
        for (int i = 0; i < n; i++)
            counter++;
    }

    private static void LockIncrement(int n)
    {
        for (int i = 0; i < n; i++)
        {
            lock (lockObj)
            {
                counter++;
            }
        }
    }

    private static void InterlockedIncrement(int n)
    {
        for (int i = 0; i < n; i++)
            Interlocked.Increment(ref counter);
    }
}
```

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –≤ RaceConditionDemo:

**1. –ü—Ä–æ–±–ª–µ–º–∞ –≥–æ–Ω–∫–∏ –¥–∞–Ω–Ω—ã—Ö (Race Condition):**

```csharp
private static void UnsafeIncrement(int n)
{
    for (int i = 0; i < n; i++)
        counter++;
}
```

- **–ü—Ä–æ–±–ª–µ–º–∞**: –û–ø–µ—Ä–∞—Ü–∏—è `counter++` –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ–π. –û–Ω–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä–µ—Ö —à–∞–≥–æ–≤:
  1. –ß—Ç–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è `counter`
  2. –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ 1
  3. –ó–∞–ø–∏—Å—å –Ω–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ –≤ `counter`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ—Ç–æ–∫–∞–º–∏ –≤–æ–∑–º–æ–∂–Ω–∞ –ø–æ—Ç–µ—Ä—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- **–û–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**: `threadsCount * increments` (–Ω–∞–ø—Ä–∏–º–µ—Ä, 4 * 100000 = 400000)
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**: –û–±—ã—á–Ω–æ –º–µ–Ω—å—à–µ –æ–∂–∏–¥–∞–µ–º–æ–≥–æ –∏–∑-–∑–∞ –≥–æ–Ω–∫–∏ –¥–∞–Ω–Ω—ã—Ö

**2. –†–µ—à–µ–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º lock:**

```csharp
private static void LockIncrement(int n)
{
    for (int i = 0; i < n; i++)
    {
        lock (lockObj)
        {
            counter++;
        }
    }
}
```

- **–ú–µ—Ö–∞–Ω–∏–∑–º**: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ `lock` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–∑–∞–∏–º–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ (mutex)
- **–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã**:
  - –ü–æ—Ç–æ–∫, –≤–æ—à–µ–¥—à–∏–π –≤ –±–ª–æ–∫ `lock`, –ø–æ–ª—É—á–∞–µ—Ç —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø
  - –î—Ä—É–≥–∏–µ –ø–æ—Ç–æ–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –¥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
  - –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ `counter++`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –¢–æ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `threadsCount * increments`
- **–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏**: –ë–æ–ª–µ–µ –º–µ–¥–ª–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–∑-–∑–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

**3. –†–µ—à–µ–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Interlocked:**

```csharp
private static void InterlockedIncrement(int n)
{
    for (int i = 0; i < n; i++)
        Interlocked.Increment(ref counter);
}
```

- **–ú–µ—Ö–∞–Ω–∏–∑–º**: –ê—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è `Interlocked.Increment`
- **–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã**:
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
  - –ë–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω, —á–µ–º `lock` –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
  - –ù–µ —Ç—Ä–µ–±—É–µ—Ç —è–≤–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –¢–æ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `threadsCount * increments`
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**: –ë–æ–ª–µ–µ –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å `lock`

**4. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**

```csharp
Stopwatch sw = Stopwatch.StartNew();
// –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞
sw.Stop();
Console.WriteLine($"–í—Ä–µ–º—è: {sw.ElapsedMilliseconds} ms, –ò—Ç–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ counter = {counter}");
```

- **UnsafeIncrement**: –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π, –Ω–æ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- **LockIncrement**: –ú–µ–¥–ª–µ–Ω–Ω–µ–µ –∏–∑-–∑–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫, –Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- **InterlockedIncrement**: –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏

## 4. –ó–∞–¥–∞–Ω–∏–µ 2: Producer-Consumer (ProducerConsumer.cs)

```csharp
using System;
using System.Collections.Concurrent;
using System.Threading;
using System.Threading.Tasks;

public static class ProducerConsumerDemo
{
    public static void Run()
    {
        Console.WriteLine("\n--- –ó–∞–¥–∞–Ω–∏–µ 2: Producer‚ÄìConsumer ---");

        var queue = new BlockingCollection<int>(boundedCapacity: 100);
        var cts = new CancellationTokenSource();

        Console.WriteLine("–ù–∞–∂–º–∏—Ç–µ –ª—é–±—É—é –∫–ª–∞–≤–∏—à—É –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏...");
        Task.Run(() =>
        {
            Console.ReadKey();
            cts.Cancel();
        });

        // Producer
        Task producer = Task.Run(() =>
        {
            for (int i = 1; i <= 50; i++)
            {
                queue.Add(i);
                Console.WriteLine($"Produced: {i}");
                Thread.Sleep(50);
            }
            queue.CompleteAdding();
        });

        // Consumers
        Task[] consumers = new Task[3];
        for (int i = 0; i < consumers.Length; i++)
        {
            consumers[i] = Task.Run(() =>
            {
                try
                {
                    foreach (var item in queue.GetConsumingEnumerable(cts.Token))
                    {
                        int result = item * 2;
                        Thread.Sleep(100);
                        Console.WriteLine($"Consumer {Task.CurrentId} processed: {item} -> {result}");
                    }
                }
                catch (OperationCanceledException)
                {
                    Console.WriteLine($"Consumer {Task.CurrentId} canceled");
                }
            }, cts.Token);
        }

        Task.WaitAll(consumers);
        Console.WriteLine("–í—Å–µ –∑–∞–¥–∞—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã.");
    }
}
```

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –≤ ProducerConsumerDemo:

**1. –ü–∞—Ç—Ç–µ—Ä–Ω Producer-Consumer:**

- **Producer**: –°–æ–∑–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–º–µ—â–∞–µ—Ç –∏—Ö –≤ –æ—á–µ—Ä–µ–¥—å
- **Consumer**: –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö
- **Queue**: –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –±—É—Ñ–µ—Ä –º–µ–∂–¥—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–º –∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º–∏

**2. BlockingCollection<T>:**

```csharp
var queue = new BlockingCollection<int>(boundedCapacity: 100);
```

- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Producer-Consumer
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏/–∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –µ–º–∫–æ—Å—Ç–∏ (bounded capacity)
  - –ú–µ—Ç–æ–¥ `CompleteAdding()` —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ–± –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
  - –ú–µ—Ç–æ–¥ `GetConsumingEnumerable()` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ–ª—å –¥–ª—è –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π

**3. Producer (–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å):**

```csharp
Task producer = Task.Run(() =>
{
    for (int i = 1; i <= 50; i++)
    {
        queue.Add(i);          // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –æ—á–µ—Ä–µ–¥—å
        Console.WriteLine($"Produced: {i}");
        Thread.Sleep(50);      // –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã
    }
    queue.CompleteAdding();   // –°–∏–≥–Ω–∞–ª –æ–± –æ–∫–æ–Ω—á–∞–Ω–∏–∏
});
```

- **–õ–æ–≥–∏–∫–∞**: –°–æ–∑–¥–∞–µ—Ç 50 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (—á–∏—Å–ª–∞ –æ—Ç 1 –¥–æ 50)
- **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ**: –ú–µ—Ç–æ–¥ `queue.Add(i)` –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –µ—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å –ø–æ–ª–Ω–∞
- **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ**: –í—ã–∑–æ–≤ `CompleteAdding()` —Å–æ–æ–±—â–∞–µ—Ç –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º, —á—Ç–æ –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–µ –±—É–¥–µ—Ç

**4. Consumers (–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏):**

```csharp
Task[] consumers = new Task[3];
for (int i = 0; i < consumers.Length; i++)
{
    consumers[i] = Task.Run(() =>
    {
        try
        {
            foreach (var item in queue.GetConsumingEnumerable(cts.Token))
            {
                int result = item * 2;          // –û–±—Ä–∞–±–æ—Ç–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–∞
                Thread.Sleep(100);             // –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã
                Console.WriteLine($"Consumer {Task.CurrentId} processed: {item} -> {result}");
            }
        }
        catch (OperationCanceledException)
        {
            Console.WriteLine($"Consumer {Task.CurrentId} canceled");
        }
    }, cts.Token);
}
```

- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ**: 3 –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- **–û–±—Ä–∞–±–æ—Ç–∫–∞**: –ö–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç —É–º–Ω–æ–∂–∞–µ—Ç—Å—è –Ω–∞ 2
- **GetConsumingEnumerable**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π:
  - –ë–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –µ—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞
  - –ó–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –æ—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞ –∏ –≤—ã–∑–≤–∞–Ω `CompleteAdding()`
  - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ç–º–µ–Ω—É —á–µ—Ä–µ–∑ `CancellationToken`

**5. –û—Ç–º–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–π:**

```csharp
var cts = new CancellationTokenSource();

Console.WriteLine("–ù–∞–∂–º–∏—Ç–µ –ª—é–±—É—é –∫–ª–∞–≤–∏—à—É –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏...");
Task.Run(() =>
{
    Console.ReadKey();
    cts.Cancel();
});
```

- **CancellationTokenSource**: –ò—Å—Ç–æ—á–Ω–∏–∫ —Ç–æ–∫–µ–Ω–æ–≤ –æ—Ç–º–µ–Ω—ã
- **CancellationToken**: –ü–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∑–∞–¥–∞—á–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ—Ç–º–µ–Ω—ã
- **OperationCanceledException**: –ò—Å–∫–ª—é—á–µ–Ω–∏–µ, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º–æ–µ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ
- **–û–±—Ä–∞–±–æ—Ç–∫–∞**: –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è

**6. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:**

```csharp
Task.WaitAll(consumers);
Console.WriteLine("–í—Å–µ –∑–∞–¥–∞—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã.");
```

- **Task.WaitAll**: –û–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á-–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π
- **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞**: –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –æ–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π
- **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ**: –í—ã–≤–æ–¥–∏—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á

## 5. –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è

### 5.1 –ü–æ—Ç–æ–∫–∏ (Threads)

```csharp
// –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ –ø–æ—Ç–æ–∫–∞
Thread thread = new Thread(() => SomeMethod());
thread.Start();

// –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞
thread.Join();

// –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ (Task)
Task task = Task.Run(() => SomeMethod());
Task.WaitAll(tasks);
```

### 5.2 –ü—Ä–æ–±–ª–µ–º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–ì–æ–Ω–∫–∞ –¥–∞–Ω–Ω—ã—Ö (Race Condition):**
- –í–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –æ–±—â–∏–º –¥–∞–Ω–Ω—ã–º
- –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤
- –ü—Ä–∏–º–µ—Ä: –ù–µ–∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (`counter++`, `check-then-act`)

**–í–∑–∞–∏–º–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (Deadlock):**
- –î–≤–∞ –∏–ª–∏ –±–æ–ª–µ–µ –ø–æ—Ç–æ–∫–æ–≤ –±–ª–æ–∫–∏—Ä—É—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞
- –ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –æ–∂–∏–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å, —É–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π –¥—Ä—É–≥–∏–º –ø–æ—Ç–æ–∫–æ–º
- –†–µ—à–µ–Ω–∏–µ: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∑–∞—Ö–≤–∞—Ç–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫, —Ç–∞–π–º–∞—É—Ç—ã

**–ì–æ–ª–æ–¥–∞–Ω–∏–µ (Starvation):**
- –ü–æ—Ç–æ–∫ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å—É –∏–∑-–∑–∞ –¥—Ä—É–≥–∏—Ö –ø–æ—Ç–æ–∫–æ–≤
- –†–µ—à–µ–Ω–∏–µ: –°–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

### 5.3 –ú–µ—Ö–∞–Ω–∏–∑–º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**1. Lock (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞):**

```csharp
private static object lockObj = new object();

lock (lockObj)
{
    // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–µ–∫—Ü–∏—è
    counter++;
}
```

- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –≤–∑–∞–∏–º–Ω–æ–≥–æ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- **–ü—Ä–∏–Ω—Ü–∏–ø**: –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –º–æ–∂–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Å–µ–∫—Ü–∏–∏
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: `Monitor.Enter()` / `Monitor.Exit()`

**2. Interlocked –æ–ø–µ—Ä–∞—Ü–∏–∏:**

```csharp
Interlocked.Increment(ref counter);
Interlocked.Decrement(ref counter);
Interlocked.Exchange(ref variable, newValue);
```

- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ –ø—Ä–æ—Å—Ç—ã–º–∏ —Ç–∏–ø–∞–º–∏
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**: –ë–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã, —á–µ–º `lock`
- **–û–ø–µ—Ä–∞—Ü–∏–∏**: –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç, –¥–µ–∫—Ä–µ–º–µ–Ω—Ç, –æ–±–º–µ–Ω, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ–±–º–µ–Ω–æ–º

**3. BlockingCollection<T>:**

```csharp
var queue = new BlockingCollection<int>(boundedCapacity: 100);

// Producer
queue.Add(item);          // –ë–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –µ—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å –ø–æ–ª–Ω–∞

// Consumer
foreach (var item in queue.GetConsumingEnumerable())
{
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–∞
}
```

- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –¥–ª—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Producer-Consumer
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏/–∏–∑–≤–ª–µ—á–µ–Ω–∏–∏

**4. CancellationToken:**

```csharp
var cts = new CancellationTokenSource();
var token = cts.Token;

// –û—Ç–º–µ–Ω–∞
cts.Cancel();

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–º–µ–Ω—ã
token.ThrowIfCancellationRequested();

// –ü–µ—Ä–µ–¥–∞—á–∞ –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã
Task.Run(() => SomeMethod(), token);
```

- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û—Ç–º–µ–Ω–∞ –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ú–µ—Ö–∞–Ω–∏–∑–º**: –ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –æ—Ç–º–µ–Ω–∞ —á–µ—Ä–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–æ–∫–µ–Ω–∞

### 5.4 Task Parallel Library (TPL)

```csharp
// –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
Task task = Task.Run(() => SomeMethod());

// –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
task.Wait();

// –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
task.ContinueWith(t => Console.WriteLine("Completed"));

// –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
Parallel.For(0, 100, i => ProcessItem(i));
Parallel.ForEach(items, item => ProcessItem(item));
```

### 5.5 –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ

```csharp
// –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥
public async Task<string> GetDataAsync()
{
    // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
    var data = await httpClient.GetStringAsync(url);
    return data;
}

// –ó–∞–ø—É—Å–∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
var result = await GetDataAsync();
```

## 6. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### 6.1 Unsafe vs Safe –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç

| –ü–æ–¥—Ö–æ–¥ | –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å | –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|--------|--------------|-------------------|-----------|
| Unsafe (`counter++`) | ‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π | ‚ö° –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π | ‚≠ê –ü—Ä–æ—Å—Ç–æ–π |
| Lock (`lock { counter++ }`) | ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π | üê¢ –ú–µ–¥–ª–µ–Ω–Ω—ã–π | ‚≠ê –ü—Ä–æ—Å—Ç–æ–π |
| Interlocked (`Interlocked.Increment`) | ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π | ‚ö° –ë—ã—Å—Ç—Ä—ã–π | ‚≠ê –ü—Ä–æ—Å—Ç–æ–π |

### 6.2 Producer-Consumer —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

| –ü–æ–¥—Ö–æ–¥ | –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|--------|-------------------|-------------------|-----------|
| –ü—Ä–æ—Å—Ç–∞—è –æ—á–µ—Ä–µ–¥—å + lock | ‚úÖ –î–∞ | üê¢ –ù–∏–∑–∫–∞—è | ‚≠ê‚≠ê –°—Ä–µ–¥–Ω—è—è |
| ConcurrentQueue | ‚úÖ –î–∞ | ‚ö° –í—ã—Å–æ–∫–∞—è | ‚≠ê –ü—Ä–æ—Å—Ç–æ–π |
| BlockingCollection | ‚úÖ –î–∞ | ‚ö°‚ö° –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è | ‚≠ê –ü—Ä–æ—Å—Ç–æ–π |

## 7. –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã

### 7.1 –ó–∞–¥–∞–Ω–∏–µ 1: –ì–æ–Ω–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```
–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ:
1 ‚Äî –ì–æ–Ω–∫–∞ –¥–∞–Ω–Ω—ã—Ö
2 ‚Äî Producer‚ÄìConsumer
0 ‚Äî –í—ã—Ö–æ–¥
–í–∞—à –≤—ã–±–æ—Ä: 1

--- –ó–∞–¥–∞–Ω–∏–µ 1: –ì–æ–Ω–∫–∞ –¥–∞–Ω–Ω—ã—Ö ---
–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤: 4
–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ç–æ–∫–∞: 100000
–í—ã–≤–æ–¥–∏—Ç—å —à–∞–≥–∏? (y/n): n

UnsafeIncrement:
–í—Ä–µ–º—è: 45 ms, –ò—Ç–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ counter = 387452

LockIncrement:
–í—Ä–µ–º—è: 187 ms, –ò—Ç–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ counter = 400000

InterlockedIncrement:
–í—Ä–µ–º—è: 98 ms, –ò—Ç–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ counter = 400000
```

**–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**
- **UnsafeIncrement**: –ë—ã—Å—Ç—Ä–æ, –Ω–æ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (387452 –≤–º–µ—Å—Ç–æ 400000)
- **LockIncrement**: –ú–µ–¥–ª–µ–Ω–Ω–æ, –Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (400000)
- **InterlockedIncrement**: –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å (400000 –∑–∞ 98 –º—Å)

### 7.2 –ó–∞–¥–∞–Ω–∏–µ 2: Producer-Consumer

```
–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ:
1 ‚Äî –ì–æ–Ω–∫–∞ –¥–∞–Ω–Ω—ã—Ö
2 ‚Äî Producer‚ÄìConsumer
0 ‚Äî –í—ã—Ö–æ–¥
–í–∞—à –≤—ã–±–æ—Ä: 2

--- –ó–∞–¥–∞–Ω–∏–µ 2: Producer‚ÄìConsumer ---
–ù–∞–∂–º–∏—Ç–µ –ª—é–±—É—é –∫–ª–∞–≤–∏—à—É –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏...
Produced: 1
Produced: 2
Consumer 1 processed: 1 -> 2
Consumer 2 processed: 2 -> 4
Produced: 3
Consumer 3 processed: 3 -> 6
Produced: 4
Consumer 1 processed: 4 -> 8
... (–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –≤—ã–≤–æ–¥–∞)

(–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–ª–∞–≤–∏—à—É)

Consumer 1 canceled
Consumer 2 canceled
Consumer 3 canceled
–í—Å–µ –∑–∞–¥–∞—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã.
```

**–ê–Ω–∞–ª–∏–∑ —Ä–∞–±–æ—Ç—ã:**
- Producer —Å–æ–∑–¥–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã —Å 1 –¥–æ 50
- 3 –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —ç–ª–µ–º–µ–Ω—Ç—ã
- –ö–∞–∂–¥—ã–π –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å —É–º–Ω–æ–∂–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç –Ω–∞ 2
- –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–ª–∞–≤–∏—à–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è

## 8. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 8.1 –ò–∑–º–µ—Ä–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```csharp
Stopwatch sw = Stopwatch.StartNew();
// –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞
sw.Stop();
Console.WriteLine($"–í—Ä–µ–º—è: {sw.ElapsedMilliseconds} ms");
```

- **Stopwatch**: –ö–ª–∞—Å—Å –¥–ª—è –≤—ã—Å–æ–∫–æ—Ç–æ—á–Ω–æ–≥–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
- **ElapsedMilliseconds**: –í—Ä–µ–º—è –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤

### 8.2 –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞

```csharp
Console.Write("–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤: ");
int threadsCount = int.Parse(Console.ReadLine() ?? "4");
```

- **Console.ReadLine**: –ß—Ç–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ null**: –û–ø–µ—Ä–∞—Ç–æ—Ä `??` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **–ü–∞—Ä—Å–∏–Ω–≥**: `int.Parse` –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ

### 8.3 –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞–º–∏

```csharp
Thread[] threads = new Thread[threadsCount];
for (int i = 0; i < threadsCount; i++)
{
    threads[i] = new Thread(() => incrementMethod(increments));
    threads[i].Start();
}

foreach (var t in threads)
    t.Join();
```

- **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤**: –ú–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ `Thread`
- **–ó–∞–ø—É—Å–∫**: –ú–µ—Ç–æ–¥ `Start()` –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ—Ç–æ–∫
- **–û–∂–∏–¥–∞–Ω–∏–µ**: –ú–µ—Ç–æ–¥ `Join()` –æ–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞

### 8.4 Task –∏ async/await

```csharp
// –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
Task producer = Task.Run(() => { /* –∫–æ–¥ */ });

// –û–∂–∏–¥–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–∞–¥–∞—á
Task.WaitAll(consumers);

// –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
Task.Run(() => { /* –∫–æ–¥ */ }, cts.Token);
```

- **Task.Run**: –ó–∞–ø—É—Å–∫ –∑–∞–¥–∞—á–∏ –≤ –ø—É–ª–µ –ø–æ—Ç–æ–∫–æ–≤
- **Task.WaitAll**: –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á
- **CancellationToken**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ç–º–µ–Ω—ã –≤ –∑–∞–¥–∞—á–∞—Ö

## 9. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

–ö–æ–Ω—Ü–µ–ø—Ü–∏–∏, –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ, –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö:

1. **–í–µ–±-—Å–µ—Ä–≤–µ—Ä—ã**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö**: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö
3. **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã**: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ–º –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏
4. **–ò–≥—Ä–æ–≤—ã–µ –¥–≤–∏–∂–∫–∏**: –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–≥—Ä–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ –∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
5. **–ù–∞—É—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è**: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ä–∞—Å—á–µ—Ç–æ–≤

## 10. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∫–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è:

1. **–ì–æ–Ω–∫–∞ –¥–∞–Ω–Ω—ã—Ö**: –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –¥–æ—Å—Ç—É–ø–µ –∫ –æ–±—â–∏–º –¥–∞–Ω–Ω—ã–º
2. **–ú–µ—Ö–∞–Ω–∏–∑–º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**: `lock`, `Interlocked`, `BlockingCollection`
3. **–ü–∞—Ç—Ç–µ—Ä–Ω Producer-Consumer**: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏
4. **–û—Ç–º–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–π**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `CancellationToken`
5. **–ò–∑–º–µ—Ä–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
6. **Task Parallel Library**: –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏

–ü—Ä–æ–µ–∫—Ç —Å–ª—É–∂–∏—Ç –æ—Ç–ª–∏—á–Ω–æ–π –æ—Å–Ω–æ–≤–æ–π –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω –¥–ª—è —Ä–µ—à–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á, —Ç—Ä–µ–±—É—é—â–∏—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ—Ç–æ–∫–æ–≤.
